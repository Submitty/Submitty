(function(e,p){typeof exports=="object"&&typeof module<"u"?p(require("vue")):typeof define=="function"&&define.amd?define(["vue"],p):(e=typeof globalThis<"u"?globalThis:e||self,p(e.Vue))})(this,function(e){"use strict";const p=(n,o,r)=>{const s=n[o];return s?typeof s=="function"?s():Promise.resolve(s):new Promise((t,l)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(l.bind(null,new Error("Unknown variable dynamic import: "+o+(o.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})},V=e.defineComponent({__name:"Unknown",props:{component:{}},setup(n){return(o,r)=>(e.openBlock(),e.createElementBlock("h1",null,'Unknown component "'+e.toDisplayString(o.component)+'"',1))}}),u=(n,o)=>{const r=n.__vccOpts||n;for(const[s,t]of o)r[s]=t;return r},k=u(V,[["__scopeId","data-v-ddc22b76"]]),q=Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"})),N={async render(n,o,r={}){(await(async()=>{try{return e.createApp((await p(Object.assign({"./components/Unknown.vue":()=>Promise.resolve().then(()=>q),"./components/displayQueryResults.vue":()=>Promise.resolve().then(()=>T),"./components/downloadQuery.vue":()=>Promise.resolve().then(()=>O),"./components/performanceWarning.vue":()=>Promise.resolve().then(()=>R),"./components/popup.vue":()=>Promise.resolve().then(()=>I),"./components/queryResultsTable.vue":()=>Promise.resolve().then(()=>Y),"./components/runQuery.vue":()=>Promise.resolve().then(()=>X),"./components/sqlSchema.vue":()=>Promise.resolve().then(()=>ne),"./components/sqlToolboxPage.vue":()=>Promise.resolve().then(()=>ae),"./components/toggleColumns.vue":()=>Promise.resolve().then(()=>ue)}),`./components/${o}.vue`,3)).default,r)}catch(t){return console.error(`Could not find vue component ${o}:`,t),e.createApp(k,{component:o})}})()).mount(n)}};window.submitty=N;const S={key:0,id:"query-results-error",class:"red-message"},w={id:"query-results-error-message"},D={key:1,class:"table table-striped mobile-table"},j={key:2},E=e.defineComponent({__name:"displayQueryResults",props:{resultsData:{},queryError:{}},setup(n){return(o,r)=>(e.openBlock(),e.createElementBlock("div",null,[r[1]||(r[1]=e.createElementVNode("h2",null,"Query Results",-1)),o.queryError.error?(e.openBlock(),e.createElementBlock("div",S,[e.createElementVNode("pre",w,e.toDisplayString(o.queryError.message),1)])):e.createCommentVNode("",!0),o.resultsData.length>0&&!o.queryError.error?(e.openBlock(),e.createElementBlock("table",D,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[0]||(r[0]=e.createElementVNode("td",null,"#",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.resultsData[0],(s,t)=>(e.openBlock(),e.createElementBlock("td",{key:t},e.toDisplayString(t),1))),128))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.resultsData,(s,t)=>(e.openBlock(),e.createElementBlock("tr",{key:t},[e.createElementVNode("td",null,e.toDisplayString(t+1),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s,(l,a)=>(e.openBlock(),e.createElementBlock("td",{key:a},e.toDisplayString(l!==null?l:""),1))),128))]))),128))])])):e.createCommentVNode("",!0),!o.queryError.error&&o.resultsData.length===0?(e.openBlock(),e.createElementBlock("p",j," No results found. ")):e.createCommentVNode("",!0)]))}}),T=Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"})),h=e.defineComponent({__name:"downloadQuery",props:{data:{}},setup(n){function o(){if(!n.data.length)return;let r="";const s=Object.keys(n.data[0]);r+=`${s.map(c=>`"${c.split('"').join('""')}"`).join(",")}
`;for(const c of n.data)r+=`${s.map(i=>`"${String(c[i]??"").split('"').join('""')}"`).join(",")}
`;const t=new Blob([r],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(t),a=document.createElement("a");a.href=l,a.setAttribute("download","submitty.csv"),a.click(),URL.revokeObjectURL(l)}return(r,s)=>r.data.length?(e.openBlock(),e.createElementBlock("button",{key:0,id:"download-sql-btn",class:"btn btn-primary",onClick:o}," Download CSV ")):e.createCommentVNode("",!0)}}),O=Object.freeze(Object.defineProperty({__proto__:null,default:h},Symbol.toStringTag,{value:"Module"})),P={key:0,id:"performance-warning-system-message",class:"system-message warning performance-warning"},U={id:"performance-warning-system-message-text"},R=Object.freeze(Object.defineProperty({__proto__:null,default:u(e.defineComponent({__name:"performanceWarning",props:{performanceWarning:{type:Boolean},submittyQueries:{},courseQueries:{}},setup(n){const o=n,r=e.ref(o.performanceWarning);return(s,t)=>r.value?(e.openBlock(),e.createElementBlock("div",P,[e.createElementVNode("span",U," Developer Warning: Excessive or duplicate database queries observed: "+e.toDisplayString(s.submittyQueries.length+s.courseQueries.length)+' queries executed. Click "Show Page Details" at the bottom of the page for more info. ',1),e.createElementVNode("i",{id:"close-performance-warning-system-message",class:"fa fa-times performance-warning-close",onClick:t[0]||(t[0]=l=>r.value=!1)})])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-4a1827aa"]])},Symbol.toStringTag,{value:"Module"})),Q={key:0,class:"popup-form"},x=["id"],M={class:"form-title"},L={class:"form-buttons"},F={class:"form-button-container"},B=e.defineComponent({__name:"popup",props:{id:{default:"popup"},title:{},visible:{type:Boolean},savable:{type:Boolean},dismissText:{default:n=>n.savable?"Discard":"Close"},saveText:{default:"Save"}},emits:["toggle","save"],setup(n,{emit:o}){const r=n,s=o;return e.watch(()=>r.visible,(t,l)=>{l!==t&&(t?$(document).on("keydown.popup",a=>{a.key==="Escape"&&r.visible&&s("toggle",a.originalEvent)}):$(document).off("keydown.popup"))},{immediate:!0}),(t,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.renderSlot(t.$slots,"trigger",{},()=>[e.createElementVNode("a",{class:"btn btn-primary",onClick:l[0]||(l[0]=a=>t.$emit("toggle",a))},"Toggle popup (you should probably override this)")]),t.visible?(e.openBlock(),e.createElementBlock("div",Q,[e.createElementVNode("div",{class:"popup-box",onClick:l[5]||(l[5]=a=>t.$emit("toggle",a))},[e.createElementVNode("div",{id:t.id,class:"popup-window","data-testid":"popup-window",onClick:l[4]||(l[4]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",M,[e.createElementVNode("h1",null,e.toDisplayString(t.title),1),e.createElementVNode("button",{class:"btn btn-default close-button","data-testid":"close-button",tabindex:"0",onClick:l[1]||(l[1]=a=>t.$emit("toggle",a))}," Close ")]),e.renderSlot(t.$slots,"default",{},()=>[l[6]||(l[6]=e.createTextVNode("Default popup content (you should probably override this)"))]),e.createElementVNode("div",L,[e.createElementVNode("div",F,[e.createElementVNode("button",{class:"btn btn-default close-button","data-testid":"popup-close-button",tabindex:"0",onClick:l[2]||(l[2]=a=>t.$emit("toggle",a))},e.toDisplayString(t.dismissText),1),l[7]||(l[7]=e.createTextVNode()),t.savable?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-primary","data-testid":"popup-save-button",tabindex:"1",onClick:l[3]||(l[3]=a=>t.$emit("save",a))},e.toDisplayString(t.saveText),1)):e.createCommentVNode("",!0)])])],8,x)])])):e.createCommentVNode("",!0)],64))}}),I=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"})),z={key:0,id:"query-results-error",class:"red-message"},A={id:"query-results-error-message"},W={key:1,class:"table table-striped mobile-table"},J={key:2},Y=Object.freeze(Object.defineProperty({__proto__:null,default:e.defineComponent({__name:"queryResultsTable",props:{resultsData:{},queryError:{}},setup(n){return(o,r)=>(e.openBlock(),e.createElementBlock("div",null,[r[1]||(r[1]=e.createElementVNode("h2",null,"Query Results",-1)),o.queryError.error?(e.openBlock(),e.createElementBlock("div",z,[e.createElementVNode("pre",A,"        "+e.toDisplayString(o.queryError.message)+`
      `,1)])):e.createCommentVNode("",!0),o.resultsData.length>0&&!o.queryError.error?(e.openBlock(),e.createElementBlock("table",W,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[0]||(r[0]=e.createElementVNode("td",null,"#",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.resultsData[0],(s,t)=>(e.openBlock(),e.createElementBlock("td",{key:t},e.toDisplayString(t),1))),128))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.resultsData,(s,t)=>(e.openBlock(),e.createElementBlock("tr",{key:t},[e.createElementVNode("td",null,e.toDisplayString(t+1),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s,(l,a)=>(e.openBlock(),e.createElementBlock("td",{key:a},e.toDisplayString(l!==null?l:""),1))),128))]))),128))])])):e.createCommentVNode("",!0),!o.queryError.error&&o.resultsData.length===0?(e.openBlock(),e.createElementBlock("p",J," No results found. ")):e.createCommentVNode("",!0)]))}})},Symbol.toStringTag,{value:"Module"}));function H(n=[]){return`${document.body.dataset.courseUrl}${n.length>0?`/${n.join("/")}`:""}`}function G(){return document.body.dataset.csrfToken??""}async function K(n){const o=new FormData;o.append("csrf_token",G()),o.append("sql",n);try{const r=await fetch(H(["sql_toolbox"]),{method:"POST",body:o});if(!r.ok)throw new Error("Failed to run query.");const s=await r.json();if(s.status!=="success")throw new Error(s.message);return s}catch(r){return{status:"fail",message:r.toString()}}}const _=e.defineComponent({__name:"runQuery",props:{query:{}},emits:["changeData","changeError"],setup(n,{emit:o}){const r=o,s=async()=>{const t=await K(n.query);t.status==="fail"?(r("changeError",!0,t.message),r("changeData",[])):(r("changeData",t.data),r("changeError",!1,""))};return(t,l)=>(e.openBlock(),e.createElementBlock("button",{id:"run-sql-btn",class:"btn btn-primary",onClick:s}," Run Query "))}}),X=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"})),Z={class:"database-schema"},v={id:"sql-database-schema-content",hidden:""},ee={class:"columns-list"},te={class:"sql-database-columns",hidden:""},oe={class:"columns-list"},C=u(e.defineComponent({__name:"sqlSchema",props:{data:{}},setup(n){function o(r){const s=r.target.nextElementSibling;s&&(s.hidden=!s.hidden)}return(r,s)=>(e.openBlock(),e.createElementBlock("div",Z,[e.createElementVNode("button",{id:"sql-database-schema",class:"btn btn-primary",onClick:o}," Database Schema Documentation "),e.createElementVNode("div",v,[s[0]||(s[0]=e.createElementVNode("p",null,"Click on each table to see columns",-1)),e.createElementVNode("ul",ee,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.data,t=>(e.openBlock(),e.createElementBlock("li",{key:t.name},[e.createElementVNode("a",{class:"sql-database-table",onClick:o},e.toDisplayString(t.name),1),e.createElementVNode("div",te,[e.createElementVNode("ul",oe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,l=>(e.openBlock(),e.createElementBlock("li",{key:l.name},e.toDisplayString(l.name)+" - "+e.toDisplayString(l.type),1))),128))])])]))),128))])])]))}}),[["__scopeId","data-v-a3a361c6"]]),ne=Object.freeze(Object.defineProperty({__proto__:null,default:C},Symbol.toStringTag,{value:"Module"})),re={class:"content"},le={id:"query-results-buttons"},ae=Object.freeze(Object.defineProperty({__proto__:null,default:u(e.defineComponent({__name:"sqlToolboxPage",props:{sqlStructureData:{}},setup(n){const o=e.ref({query_name:"",query:""});function r(a,c){l.value.error=a,l.value.message=c}function s(a){t.value=a}const t=e.ref([]),l=e.ref({error:!1,message:""});return(a,c)=>(e.openBlock(),e.createElementBlock("div",re,[c[2]||(c[2]=e.createElementVNode("h1",null,"SQL Toolbox",-1)),e.createElementVNode("div",null,[c[1]||(c[1]=e.createElementVNode("div",{id:"toolbox-info"}," Use this toolbox to run a SELECT query. You cannot run any other type of query, and may only run a single query at a time. You can download a CSV of the query results. Must Run Query before you can Download. ",-1)),e.createVNode(C,{id:"sql-schema",data:a.sqlStructureData},null,8,["data"]),e.withDirectives(e.createElementVNode("textarea",{id:"toolbox-textarea","onUpdate:modelValue":c[0]||(c[0]=i=>o.value.query=i),name:"sql","aria-label":"Input SQL"},null,512),[[e.vModelText,o.value.query]]),e.createElementVNode("div",le,[e.createVNode(_,{id:"run-sql-btn",query:o.value.query,onChangeData:s,onChangeError:r},null,8,["query"]),e.createVNode(h,{id:"download-query-btn",data:t.value},null,8,["data"])])]),e.createVNode(E,{"query-error":l.value,"results-data":t.value},null,8,["query-error","results-data"])]))}}),[["__scopeId","data-v-e83d5bad"]])},Symbol.toStringTag,{value:"Module"}));/*! js-cookie v3.0.5 | MIT */function f(n){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var s in r)n[s]=r[s]}return n}var se={read:function(n){return n[0]==='"'&&(n=n.slice(1,-1)),n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(n){return encodeURIComponent(n).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function y(n,o){function r(t,l,a){if(!(typeof document>"u")){a=f({},o,a),typeof a.expires=="number"&&(a.expires=new Date(Date.now()+a.expires*864e5)),a.expires&&(a.expires=a.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var c="";for(var i in a)a[i]&&(c+="; "+i,a[i]!==!0&&(c+="="+a[i].split(";")[0]));return document.cookie=t+"="+n.write(l,t)+c}}function s(t){if(!(typeof document>"u"||arguments.length&&!t)){for(var l=document.cookie?document.cookie.split("; "):[],a={},c=0;c<l.length;c++){var i=l[c].split("="),d=i.slice(1).join("=");try{var m=decodeURIComponent(i[0]);if(a[m]=n.read(d,m),t===m)break}catch{}}return t?a[t]:a}}return Object.create({set:r,get:s,remove:function(t,l){r(t,"",f({},l,{expires:-1}))},withAttributes:function(t){return y(this.converter,f({},this.attributes,t))},withConverter:function(t){return y(f({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(o)},converter:{value:Object.freeze(n)}})}var g=y(se,{path:"/"});const ce={key:0,class:"btn-wrapper"},ie={class:"toggle-columns-menu"},de=["id","onUpdate:modelValue","disabled","data-testid"],me=["for"],pe={class:"toggle-all-buttons"},ue=Object.freeze(Object.defineProperty({__proto__:null,default:e.defineComponent({__name:"toggleColumns",props:{columns:{},labels:{},cookie:{},forced:{default:()=>[]},format:{default:"bits"},buttonWrapped:{type:Boolean}},setup(n){const o=e.ref([]),r=e.ref(!1);function s(){var c;if(n.format==="json"){const i=JSON.parse(decodeURIComponent(g.get(n.cookie)??encodeURIComponent("{}")));for(const d of Object.keys(i))n.columns.includes(d)&&(o.value[n.columns.indexOf(d)]=i[d]);for(const d of n.columns)i[d]===void 0&&(o.value[n.columns.indexOf(d)]=!0);return}else if(n.format==="bits"){const i=((c=g.get(n.cookie))==null?void 0:c.split("-"))||Array(n.columns.length).fill("1");o.value=n.columns.map((d,m)=>i[m]==="1")}}function t(){if(n.format==="json"){const c={};n.columns.forEach((i,d)=>{c[i]=o.value[d]}),g.set(n.cookie,JSON.stringify(c),{expires:365,path:"/"}),window.location.reload();return}else n.format==="bits"&&g.set(n.cookie,o.value.map(c=>c?1:0).join("-"),{expires:365,path:"/"});window.location.reload()}function l(c){o.value=o.value.map((i,d)=>{var m;return((m=n.forced)==null?void 0:m.includes(n.columns[d]))||c})}function a(){r.value=!r.value,r.value||s()}return e.onMounted(s),(c,i)=>(e.openBlock(),e.createBlock(B,{title:"Toggle Columns",visible:r.value,savable:!0,onToggle:a,onSave:t},{trigger:e.withCtx(()=>[c.buttonWrapped?(e.openBlock(),e.createElementBlock("div",ce,[e.createElementVNode("a",{id:"toggle-columns","data-testid":"toggle-columns",class:"btn btn-primary",onClick:a},"Toggle Columns")])):(e.openBlock(),e.createElementBlock("a",{key:1,id:"toggle-columns","data-testid":"toggle-columns",class:"btn btn-primary",onClick:a},"Toggle Columns"))]),default:e.withCtx(()=>[i[3]||(i[3]=e.createElementVNode("p",{class:"toggle-columns-instructions"}," Select which columns you would like to display. ",-1)),e.createElementVNode("div",ie,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.columns,(d,m)=>{var b;return e.openBlock(),e.createElementBlock("div",{key:d,class:"toggle-checkbox-area"},[e.withDirectives(e.createElementVNode("input",{id:`toggle-${d}`,"onUpdate:modelValue":fe=>o.value[m]=fe,type:"checkbox",class:"toggle-columns-box",disabled:(b=c.forced)==null?void 0:b.includes(d),"data-testid":`toggle-${d}`},null,8,de),[[e.vModelCheckbox,o.value[m]]]),e.createElementVNode("label",{for:d},e.toDisplayString(c.labels[m]),9,me)])}),128))]),e.createElementVNode("div",pe,[e.createElementVNode("a",{class:"btn btn-primary",onClick:i[0]||(i[0]=d=>l(!0))}," All On "),i[2]||(i[2]=e.createTextVNode()),e.createElementVNode("a",{class:"btn btn-primary",onClick:i[1]||(i[1]=d=>l(!1))}," All Off ")])]),_:1},8,["visible"]))}})},Symbol.toStringTag,{value:"Module"}))});