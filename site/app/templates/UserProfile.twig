<div class="content">
    <h1>
    {{ localize('My_Profile.My_Profile', "My Profile") }}
    </h1>
    <div class="user-info-wrapper">
        <div id="user-card-img">
            <div class="user-img-cont">
                {% set image = user.getDisplayImage() %}
                {% if image is not null %}
                    {{ base64_image(image.getImageBase64MaxDimension(250), image.getMimeType(), '%s %s'|format(user.getDisplayedGivenName(), user.getDisplayedFamilyName())) }}
                {% else %}
                    <span class="center-img-tag">{{ localize('My_Profile.Not_Available', "N/A") }}</span>
                {% endif %}
            </div>
            <span class="edit-user-img">
                <button class="icon" data-testid="upload-photo-button" tabindex="0" onclick="showUpdateProfilePhotoForm()" aria-label="{{ localize('My_Profile.Edit_Profile_Photo', "Edit user profile photo") }}" title="{{ localize('My_Profile.Edit_Profile_Photo', "Edit user profile photo") }}">
                    <i class="fas fa-upload"></i> {{ localize('My_Profile.Upload_profile_photo', "Upload profile photo") }}
                </button>
            </span>
            <span class="red-message" id="flagged-message" data-flagged="{{ user.getDisplayImageState }}">
                {{ localize('My_Profile.Flagged_Image_Message', "Your preferred image was flagged as inappropriate.") }}
            </span>
        </div>
        <div id="user-card">
            <div class="user-info-cont">
                <div class="user-info-title" id="basic_info">
                    <span>
                        {{ localize('My_Profile.Basic_Information', "Basic Information" )}}
                    </span>
                </div>
                <div class="user-info">
                    <div class="flex-row" id="username-row" data-testid="username-row">
                        <span class="label">
                        {{ localize('My_Profile.Username', "Username" )}}:
                        </span>
                        <span class="value">
                            {{ user.getId() }}
                        </span>
                    </div>
                    <div class="flex-row" id="givenname-row" data-testid="givenname-row">
                        <span class="label">
                        {{ localize('My_Profile.First_Name', "First Name" )}}:
                        </span>
                        <button class="icon" tabindex="0" onclick="showUpdatePrefNameForm()" aria-label="{{ localize('My_Profile.Edit_First_Name', "Edit user preferred name") }}" title="{{ localize('My_Profile.Edit_First_Name', "Edit user preferred name") }}">
                            <i class="fas fa-pencil-alt"></i> {{ user.getDisplayedGivenName() }}
                        </button>
                    </div>
                    <div class="flex-row" id="familyname-row" data-testid="familyname-row">
                        <span class="label">
                        {{ localize('My_Profile.Last_Name', "Last Name" )}}:
                        </span>
                        <button class="icon" tabindex="0" onclick="showUpdatePrefNameForm()" aria-label="{{ localize('My_Profile.Edit_Last_Name', "Edit user preferred name") }}" title="{{ localize('My_Profile.Edit_Last_Name', "Edit user preferred name") }}">
                            <i class="fas fa-pencil-alt"></i> {{ user.getDisplayedFamilyName() }}
                        </button>
                    </div>
                    <div class="flex-row" id="last-initial-format-row" data-testid="last-initial-format-row">
                        <span class="label">
                            {{ localize('My_Profile.Abbreviated_Name', "Abbreviated Name") }}:
                        </span>
                        <button class="icon" tabindex="0" onclick="showUpdateLastInitialFormatForm()" aria-label="{{ localize('My_Profile.Edit_Abbreviated_Name, "Edit user last initial format") }}" title="{{ localize('My_Profile.Edit_Abbreviated_Name, "Edit user last initial format") }}">
                            <i class="fas fa-pencil-alt"></i> {{ user.getDisplayAbbreviatedName() }}
                        </button>
                    </div>
                    <div class="flex-row" id="pronouns-row" data-testid="pronouns-row">
                        <span class="label">
                             {{ localize('My_Profile.Pronouns', "Pronouns" )}}:
                        </span>
                        <button id='pronouns_val' class="icon" tabindex="0" onclick="showUpdatePronounsForm()" aria-label="{{ localize('My_Profile.Edit_Pronouns', "Edit user pronouns") }}" title="{{ localize('My_Profile.Edit_Pronouns', "Edit user pronouns") }}">
                            <i class="fas fa-pencil-alt"></i> {{ user.getPronouns() }}
                        </button>
                    </div>
                    <div class="flex-row" id="pronouns-display-row">
                        <span class="label">
                            {{ localize('My_Profile.Pronouns_Forum', "Display Pronouns in Discussion Forum" )}}:
                        </span>
                        <button id='display_pronouns_val' class="icon" tabindex="0" onclick="showUpdatePronounsForm()" aria-label="{{ localize('My_Profile.Edit_Pronouns', "Edit user pronouns") }}" title="{{ localize('My_Profile.Edit_Pronouns', "Edit user pronouns") }}">
                            {% if user.getDisplayPronouns() %}
                                <i class="fas fa-pencil-alt"></i> True
                            {% else %}
                                <i class="fas fa-pencil-alt"></i> False
                            {% endif %}
                        </button>
                    </div>
                    <div class="flex-row" id="email-row" data-testid="email-row">
                        <span class="label">
                            {{ localize('My_Profile.Primary_Email', "Primary Email" )}}:
                        </span>
                        <span class="value">
                            {{ user.getEmail() }}
                        </span>
                    </div>
                    <div class="flex-row" id="secondary-email-row">
                        <span class="label">
                            {{ localize('My_Profile.Secondary_Email', "Secondary Email" )}}:
                        </span>
                        <button class="icon" tabindex="0" onclick="showUpdateSecondaryEmailForm()" aria-label="{{ localize('My_Profile.Edit_Secondary_Email', "Edit user secondary email") }}" title="{{ localize('My_Profile.Edit_Secondary_Email', "Edit user secondary email") }}">
                            <i class="fas fa-pencil-alt"></i> {{ user.getSecondaryEmail() }}
                        </button>
                    </div>
                    <div class="flex-row" id="secondary-email-notify-row">
                        <span class="label">
                            {{ localize('My_Profile.Send_Email', "Send Email to Secondary Address" )}}:
                        </span>
                        <button class="icon" tabindex="0" onclick="showUpdateSecondaryEmailForm()" aria-label="{{ localize('My_Profile.Edit_Secondary_Email', "Edit user secondary email") }}" title="{{ localize('My_Profile.Edit_Secondary_Email', "Edit user secondary email") }}">
                            <i class="fas fa-pencil-alt"></i> {% if user.getEmailBoth() %}True{% else %}False{% endif %}
                        </button>
                    </div>
                    {% if display_access_level %}
                        <div class="flex-row" id="access-row">
                            <span class="label">
                                {{ localize('My_Profile.Access_Level', "Access Level" )}}:
                            </span>
                            <span class="value">
                                {{ access_level }}
                            </span>
                        </div>
                    {% endif %}
                    {% if show_change_password %}
                        <div class="flex-row-col" id="password-row">
                            <span>
                                {{ localize('My_Profile.Change_Password', "Change_Password" )}}:
                            </span>
                            <span>
                                <button class="icon" tabindex="0" onclick="showUpdatePasswordForm()" aria-label="{{ localize('My_Profile.Change_Password', "Change Password") }}" title="{{ localize('My_Profile.Change_Password', "Change Password") }}">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                            </span>
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="user-info-cont">
                <div class="user-info-title">
                <span id="time_zone_selector_label"
                        data-user_time_zone="{{ user_time_zone_with_offset }}"
                        data-available_time_zones="{{ available_time_zones }}"
                >{{ localize('My_Profile.Time_Zone', "Time Zone") }} (<span id="utc_offset_stub">{{ localize('My_Profile.UTC_Offset', "UTC Offset") }} <span id="user_utc_offset">{{ user_utc_offset }}</span></span>):
                    <a target="_blank" href="https://submitty.org/student/account/local_timezone" aria-label="{{ localize('My_Profile.Specify_Timezone_Help', "How can I specify my local timezone?") }}">
                        <i style="font-style:normal;" class="fa-question-circle"></i>
                    </a>
                </span>
                </div>
                <div class="user-info">
                    <div class="flex-row-col">
                        <label for="time_zone_drop_down">{{ localize('My_Profile.Select_Timezone', "Select Timezone:") }}</label>
                        <select id="time_zone_drop_down" data-testid="time-zone-dropdown"></select>
                    </div>
                </div>
                <div class="user-info-cont">
                    <div class="user-info-title">
                        <span>{{ localize('My_Profile.Preferred_Locale', "Preferred Locale (Language/Region):") }}
                            <a target="_blank" href="https://submitty.org/developer/development_instructions/localization" aria-label="{{ localize('My_Profile.Contribute_To_Translation_Help', "How can I contribute to Language Translation?") }}">
                                <i style="font-style:normal;" class="fa-question-circle"></i>
                            </a>
                        </span>
                    </div>
                    <div class="user-info">
                        <div class="flex-row-col">
                            <label for="pref_locale_select">{{ localize('My_Profile.Choose_Locale', "Choose a locale:") }}</label>
                            {% set user_locale = user.getPreferredLocale() %}
                            <select id="pref_locale_select">
                                <option value="0">{{ localize('My_Profile.Default_Locale', "[Default] | ") }}{{ default_locale_name }}</option>
                                {% for locale, locale_name in supported_locales %}
                                <option value="{{ locale }}" {% if locale == user_locale %}selected{% endif %}>{{ locale_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% if user_locale != 'en_US' and user_locale != '' %}
                        <div class="tip-note" style="text-align: right; margin-left: 25%;">{{ localize('My_Profile.Incomplete_Language_Support_Note', "Note: Support for languages other than English is currently incomplete. If you would like to contribute to translation, see our guidelines here.") }} <a href="https://submitty.org/developer/development_instructions/localization">{{ localize('My_Profile.Here', "here") }}</a>.</div>
                        {% endif %}
                    </div>
                </div>
                <div class="user-info-cont">
                    <div class="user-info-title">
                        <span>{{ localize('My_Profile.Color_Theme', "Color Theme:") }}</span>
                    </div>
                    <div class="user-info">
                        <div class="flex-row-col">
                            <label for="theme_change_select">{{ localize('My_Profile.Choose_Color_Theme', "Choose a color theme") }}</label>
                            <select id="theme_change_select" class="form-control" aria-label="{{ localize('My_Profile.Change_Theme', "Change Submitty's Theme") }}" data-testid="theme-change-dropdown">
                                <option value="system">{{ localize('My_Profile.Follow_Device_Theme', "Follow Device Theme") }}</option>
                                <option value="system_black">{{ localize('My_Profile.Follow_Device_Theme_Black', "Follow Device Theme (Black)") }}</option>
                                <option value="light">{{ localize('My_Profile.Light_Mode', "Light Mode") }}</option>
                                <option value="dark">{{ localize('My_Profile.Dark_Mode', "Dark Mode") }}</option>
                                <option value="dark_black">{{ localize('My_Profile.Dark_Mode_Black', "Dark Mode (Black)") }}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="user-info-cont">
                    <div class="user-info-title">
                        <span>{{ localize('My_Profile.Sidebar_Preference', "Sidebar Preference:") }}</span>
                    </div>
                    <div class="user-info">
                        <div class="flex-row-col">
                            <label for="desktop_sidebar_preference">{{ localize('My_Profile.Choose_Sidebar_Preference', "Choose a sidebar preference") }}</label>
                            <select id="desktop_sidebar_preference" class="form-control" aria-label="{{ localize('My_Profile.Change_Sidebar_Preference', "Change Sidebar Preference") }}" data-testid="desktop-sidebar-preference-dropdown">
                                <option value="automatic">{{ localize('My_Profile.Default_Sidebar', "[Default] | Collapse On Narrow View") }}</option>
                                <option value="manual">{{ localize('My_Profile.Disable_Automatic_Collapse', "Disable Automatic Collapse") }}</option>
                            </select>
                        </div>
                    </div>
                </div>          
            <div>
                <span class="option-alt" id="browser-support">
                    {{ localize('My_Profile.PWA_Support_Chrome', "Submitty supports an installable Progressive Web App (PWA) which requires Chrome, see") }} 
                    <a href="https://support.google.com/chrome/answer/9658361">{{ localize('My_Profile.Here', "here") }}</a> 
                    {{ localize('My_Profile.Installation_Instructions', "for installation instructions") }}
                </span>
                <button class="addpwa btn btn-primary">{{ localize('My_Profile.Install_App', "Install App") }}</button>
                <span class="option-alt" id="pwa-uninstall-label">
                    {{ localize('My_Profile.PWA_Installed', "The Submitty Progressive Web App (PWA) has already been installed, see") }} 
                    <a href="https://support.google.com/chrome/answer/9658361">{{ localize('My_Profile.Here', "here") }}</a> 
                    {{ localize('My_Profile.To_Uninstall', "to uninstall it") }}
                </span>
            </div>
            <div class="flex-row-col">
                <button class="btn btn-primary" id="auth-tokens-btn" onclick="location.href='authentication_tokens';">
                    <i class="fa fa-key"></i>
                    {{ localize('My_Profile.Authentication_Tokens', "Authentication Tokens") }}
                </button>
                <button class="btn btn-primary" onclick="location.href='manage_sessions';">
                    <i class="fa fa-user-shield"></i>
                    {{ localize('My_Profile.Manage_Sessions', "Manage Sessions") }}
                </button>
            </div>
        </div>
    </div>
</div>
{% include 'EditNameForm.twig' %}
{% include 'EditLastInitialFormatForm.twig' %}
{% include 'EditProfilePhotoForm.twig' %}
{% include 'EditSecondaryEmailForm.twig' %}
{% include 'EditPronounsForm.twig' %}
{% if show_change_password %}
    {% include 'ChangePasswordForm.twig' %}
{% endif %}
