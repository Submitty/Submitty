<div class="content">
    <div class="sub">

        {# Actual results #}
        {% if in_queue or in_progress_grading %}
            {% if in_progress_grading %}
                <p class="red-message">
                    This submission is currently being graded.
                </p>
            {% else %}
                <p class="red-message">
                    This submission is currently in the queue to be graded. Your submission is number {{ queue_pos }} out of {{ queue_total }}.
                </p>
            {% endif %}
            <script>
                checkRefreshPage("{{ check_refresh_submission_url|e('js') }}")
            </script>
        {% elseif results is not defined %}
            <p class="red-message">
                There was an error retrieving the grading results for this submission. It might be due to a network
                issue, a temporary server problem, or an internal error in the grading system. Try refreshing
                the page. If the issue persists, please contact your instructor for assistance.
            </p>
            <script>
                (() => {
                    const params = new URLSearchParams(window.location.search);
                    const loadAttempt = Number(params.get('loadAttempt') ?? '0');
                    if (loadAttempt < 3) {
                        params.set('loadAttempt', loadAttempt + 1);
                        window.location.search = params.toString();
                    }
                })();
            </script>
        {% else %}
            {# Has results! #}
            {% if show_incentive_message is defined and show_incentive_message %}
                <script>
                    (function() {
                        $('#incentive_message').show();
                    })();
                </script>
            {% endif %}
        {% endif %}

        {{ result_text|raw }}
    </div>
</div>
