---
# Assumes that local user accounts for instructor already exist.

- name: Add instructors to the course groups.
  ansible.builtin.user:
    name: "{{ username }}"
    groups: "{{ submitty_course_add_instructor_groups }}"
    append: true
  loop:
    - "{{ course }}"
    - "{{ course }}_tas_www"
    - "{{ course }}_archive"
  loop_control:
    loop_var: submitty_course_add_instructor_groups

- name: Give course management permissions to "{{ username }}".
  ansible.builtin.user:
    name: "{{ submitty_course_add_instructor_users }}"
    groups: "submitty_course_builders"
    append: true
  loop:
    - "{{ username }}"
  loop_control:
    loop_var: submitty_course_add_instructor_users
  notify: Reload fpm


- name: Run add_user role
  ansible.builtin.include_role:
    name: submitty_course_add_user
  vars:
    submitty_course_add_user_username: "{{ username }}"
    submitty_course_add_user_firstname: "{{ firstname }}"
    submitty_course_add_user_lastname: "{{ lastname }}"
    submitty_course_add_user_email: "{{ email }}"
    submitty_course_add_user_password: "{{ password }}"
    submitty_course_add_user_semester: "{{ semester }}"
    submitty_course_add_user_course: "{{ course }}"
    submitty_course_add_user_user_group: "{{ user_group }}"
