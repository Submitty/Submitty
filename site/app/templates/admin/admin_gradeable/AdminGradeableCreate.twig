<!-- Debugging Stuff -->
{{ admin_gradeable.getGGradeableType() }}
{{ admin_gradeable.getEgInheritTeamsFrom() }}
<br />



TODO: Add necessary lines (finding locations of eg_team_assignment for reference) to 
    fetch eg_inherit_teams_from from the database and insert it if required (see stash maybe)

{#
    Combo box for choosing an existing gradeable as a template for the new one
        (Only show this option if we aren't in edit mode).
#}
{% if ((type_of_action == 'add') or (type_of_action == 'add_template')) %}
    <div>
        From Template: 
        <select name="gradeable_template" style='width: 170px;' value=''>
            <option>--None--</option>

            {% for template in admin_gradeable.getTemplateList() %}
                <option {{ admin_gradeable.getGId() == template.g_id ? 'selected' : '' }}
                    value="{{ template.g_id }}">{{ template.g_title }}</option>
            {% endfor %}
        </select>
    </div>
{% endif %}

{# 
    Primary Form
#}
<div class="modal-body" style="/*padding-bottom:80px;*/ overflow:visible;">

    <!-- Gradeable ID (readonly in edit mode, required) -->
    What is the unique id of this gradeable? (e.g., <kbd>hw01</kbd>, <kbd>lab_12</kbd>, or <kbd>midterm</kbd>):
        <input style='width: 200px' type='text' name='gradeable_id' id="gradeable_id" class="required" 
            value="{{ admin_gradeable.getGId() }}" placeholder="(Required)" {{ type_of_action == 'edit' ? 'readonly' : 'required' }} />

    <br />

    <!-- Gradeable Title (read/write in all modes) -->
    What is the title of this gradeable?: 
        <input style='width: 227px' type='text' name='gradeable_title' id='gradeable_title_id' class="required" 
            value="{{ admin_gradeable.getGTitle() }}" placeholder="(Required)" required/>

    <br />

    <!-- Instruction URL (read/write in all modes) -->
    What is the URL to the assignment instructions? (shown to student) 
        <input style='width: 227px' type='text' name='instructions_url' 
            value="{{ admin_gradeable.getGInstructionsUrl() }}" placeholder="(Optional)" />

    <br /> 

    <!-- Gradeable Type radio buttons (readonly in edit mode) -->
    What is the <a target=_blank href="http://submitty.org/instructor/create_edit_gradeable#types-of-gradeables">type of the gradeable</a>?: 
        <!-- TODO: this should disappear once a type is selected -->
        <div id="required_type" style="color:red; display:inline;">(Required)</div>

        <input type='radio' id="radio_electronic_file" class="electronic_file" name="gradeable_type" value="Electronic File"
            {{ (admin_gradeable.getGGradeableType() == 0) ? 'checked' : '' }}
            {{ type_of_action == "edit" ? disabled : null }}> Electronic File

        <input type='radio' id="radio_checkpoints" class="checkpoints" name="gradeable_type" value="Checkpoints"
            {{ (admin_gradeable.getGGradeableType() == 1) ? 'checked' : '' }}
            {{ type_of_action == "edit" ? disabled : null }}> Checkpoints

        <input type='radio' id="radio_numeric" class="numeric" name="gradeable_type" value="Numeric"
            {{ (admin_gradeable.getGGradeableType() == 2) ? 'checked' : '' }}
            {{ type_of_action == "edit" ? disabled : null }}> Numeric/Text 

    <br />

    <!-- This is only relevant to Electronic Files -->
    <fieldset class="gradeable_type_options electronic_file" id="electronic_file">

        <br />
        Is this a team assignment? <em style='color:green;'>Team assignments are new as of Fall 2017.  Email questions/bugs/feedback to: submitty@cs.rpi.edu.</em>
        <br />
            <input type="radio" id = "team_yes_radio" class="team_yes" name="team_assignment" value="true"
                {{ admin_gradeable.getEgTeamAssignment() ? 'checked' : '' }}
                {{ type_of_action == "edit" ? 'disabled' : '' }}> Yes

            <input type="radio" id = "team_no_radio" class="team_no" name="team_assignment" value ="false"
                {{ not admin_gradeable.getEgTeamAssignment() ? 'checked' : '' }}
                {{ type_of_action == "edit" ? 'disabled' : '' }}> No

        <!-- Team settings (read only in edit mode) -->
        <div id="team_settings">
            <div class="team_assignment team_yes" id="team_yes">
                <br />

                <!-- Inherit teams from a nother gradeable? -->
                Use teams from a previous gradeable:

                {# 
                    Use a combo box if we can edit the value, otherwise show a text box (readonly)
                #}
                {% if (type_of_action == 'add' or type_of_action == 'add_template') %}
                    <select id='gradeable_teams' name="gradeable_teams" style='width: 170px;' 
                        value='{{ admin_gradeable.getEgInheritTeamsFrom() }}'>
                        <option value=''>--None--</option>

                        {% for parent in admin_gradeable.getInheritTeamsList() %}
                            <option {{ admin_gradeable.getEgInheritTeamsFrom() == parent.g_id ? 'selected' : '' }}
                                value="{{ parent.g_id }}">{{ parent.g_title }}</option>
                        {% endfor %}
                    </select>
                {% else %}
                    <input id='gradeable_teams_read' name='gradeable_teams_read' style='width=170px' 
                        value='{{ admin_gradeable.getEgInheritTeamsFrom() }}' readonly/>
                {% endif %}

                <br />

                <!-- If not inheriting, what are the team settings? -->
                <div id="team_details">
                    
                    <!-- Maximum Team Size -->
                    What is the maximum team size? 
                        <input style="width: 50px" name="eg_max_team_size" class="int_val" type="text" 
                            value="{{ admin_gradeable.getEgMaxTeamSize() }}"/>
                </div>
            </div>
        </div>
    </fieldset>
</div>

<script type="text/javascript">
    //
    // Event Handlers
    //
    function onGradeableTypeChange() {
        if($('#radio_electronic_file').is(':checked')) {
            $('#electronic_file').show();
            onTeamAssignmentChange();
        }
        else {
            $('#electronic_file').hide();
            $('#team_yes').hide();
        }
    }

    function onTeamAssignmentChange() {
        if($('#team_yes_radio').is(':checked')) {
            $('#team_yes').show();
        }
        else {
            $('#team_yes').hide();
        }
    }

    function onGradeableTeamsInheritChange() {
        if($('#gradeable_teams').val() !== '') {
            $('#team_details').hide();
        }
        else {
            $('#team_details').show();
        }
    }

    $(document).ready(function() {

        //
        // Template Selector Box Events
        //

        // Event handler for the gradeable template selection change
        $('[name="gradeable_template"]').change(
        function() {
            // TODO: what if this.value === ''?
            var arrayUrlParts = [];
            arrayUrlParts["component"]   = ["admin"];
            arrayUrlParts["page"]        = ["admin_gradeable"];
            arrayUrlParts["action"]      = ["upload_new_template"];
            arrayUrlParts["template_id"] = [this.value];

            // Redirect user to the same page, but in the process,
            //  fetch the data from the template gradeable
            var new_url = buildUrl(arrayUrlParts);
            window.location.href = new_url;
        });

        //
        // Gradeable Type Radio Button Events
        //

        // Hide team settings if it isn't a electronic gradeable
        onGradeableTypeChange();
        $('[name="gradeable_type"]').change(onGradeableTypeChange);

        // Hide team settings if team's are not the selected option
        onTeamAssignmentChange();
        $('[name="team_assignment"]').change(onTeamAssignmentChange);

        // Hide the team config if user selects a parent
        //      to inherit teams from        
        onGradeableTeamsInheritChange();
        $('[name="gradeable_teams"]').change(onGradeableTeamsInheritChange);
    });
</script>