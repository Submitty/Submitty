<div class="content">
    <div id="rg_web_ui_loading">
        <p>Loading...</p>
    </div>
    <div id="rg_web_ui">
        <h1>Rainbow Grades Configuration</h1>

        {% if limited_functionality_mode %}
            <div id="limited_func_messages">
                <p><strong>Notice:</strong> Rainbow Grades tools are running in limited functionality mode.  This means that grades summaries must be
                    manually generated prior to each use of this interface.  To generate grade summaries navigate to the Grade
                    Reports page, and click the "Generate Grade Summaries" button.</p>
                <p>For more information about limited functionality mode visit the
                    <a href="http://www.submitty.org/instructor/course_settings/rainbow_grades/automatic_setup">rainbow grades documentation</a>.</p>
            </div>
        {% endif %}

        <div class="report-title-cont">
            Web interface for creation and customization of Rainbow Grades for this course.
            <a target=_blank
               href="https://submitty.org/instructor/course_settings/rainbow_grades/"
            >
                Rainbow Grades Documentation
                <i style="font-style:normal;" class="fa-question-circle"></i>
            </a>
        </div>

        <div id="grade-report-summary" class="report-card">
            <div class="report-title-cont">
                Pushing this button will update the grade summary data used to generate the rainbow grades reports.
            </div>
            <div class="report-card-btn-cont">
                <button id="grade-summaries-button"
                        onclick="location.href='{{ summaries_url }}'"
                        class="btn btn-primary"
                        tabindex="0"
                >
                    Generate Grade Summaries
                </button>
                <div class="card-btn-info">
                    Last ran: <span id="grade-summaries-last-run">{{ grade_summaries_last_run }}</span>
                </div>
            </div>
        </div>

        <div id="save_status_container" class="customization_item">
            <div id="status_head">
                <div id="build_buttons">
                    <button
                    id="btn-build-customization"
                    data-testid="btn-build-customization"
                    class="btn btn-primary"
                    tabindex="0"
                    type="button"
                    onclick="runBuild()"
                    >
                    <i class="fas fa-magic-wand-sparkles" title="Build customization"></i>
                    Build
                    </button>
                </div>
                <div style="display: flex; align-items: center;">
                    <div id="status_label" style="padding-right: 4px;">Status: </div>
                    <div id="save_status" data-testid="save-status" style="margin-right: 60px;">
                    No changes to save
                    </div>
                </div>
                <div id="save_status_buttons">
                    <button style="padding: 5px 12px;" class="btn btn-default" id="show_log_button" data-testid="log-button" type="button">
                    Log
                    </button>
                </div>
            </div>
            <div id="save_status_log"></div>
        </div>
        <div id="list_wrapper">
            <div id="upload_and_download" class="customization_item">
                <div id="grade-report-customization-upload" class="card">
                    <div class="title-cont">
                    </div>
                    <div class="card-btn-cont">
                        <form action="{{ customization_upload_url }}" method="POST" enctype="multipart/form-data">
                            <input type="hidden" name="csrf_token" value="{{csrfToken}}">
                            <input type="file" id="config-upload" data-testid="config-upload" name="config_upload" style="display:none">

                            <button
                                id="btn-download-gui-customization"
                                data-testid="btn-download-gui-customization"
                                class="btn btn-default key_to_click"
                                tabindex="0"
                                type="button"
                                title="Download the GUI customization"
                                onclick="window.location.href='{{ gui_customization_download_url }}'"
                                style="margin-right: 50px"
                            >
                                <i class="fas fa-download" title="Download the file"></i>
                                Download GUI Customization
                            </button>
                            <button
                                id="btn-upload-customization"
                                data-testid="btn-upload-customization"
                                class="btn btn-default key_to_click"
                                tabindex="0"
                                type="button"
                                title="Upload a Rainbow Grades customization.json directly to Submitty"
                            >
                                <i class="fas fa-upload" title="Download the file"></i>
                                Upload Manual Customization
                            </button>
                            <button
                                id="btn-download-customization"
                                data-testid="btn-download-manual-customization"
                                class="btn btn-default key_to_click"
                                tabindex="0"
                                type="button"
                                title="Download the manual customization"
                                onclick="window.location.href='{{ manual_customization_download_url }}'"
                            >
                                <i class="fas fa-download" title="Download the file"></i>
                                Download Manual Customization
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="ask_which_customization" data-testid="ask-which-customization" class="customization_item" style="display: {{ manual_customization_exists ? 'block' : 'none' }};">
                <fieldset>
                    <legend><h2>Customization</h2></legend>
                    <input type="hidden" name="csrf_token" value="{{ csrfToken }}" />
                    <form id="customizationForm">
                        <div id="customization-options">
                            <p> A manual customization file is available. Please choose the file for rendering Rainbow Grades:</p>
                            <div>
                                <input type="radio" id="manual_customization" data-testid="manual-customization-option" name="customization" value="manual" {{ manual_customization_exists ? 'checked' : '' }}>
                                <label for="manual_customization">Manual Customization</label>
                            </div>
                            <div>
                                <input type="radio" id="gui_customization" data-testid="gui-customization-option" name="customization" value="gui" {{ manual_customization_exists ? '' : 'checked' }}>
                                <label for="gui_customization">GUI Customization</label>
                            </div>
                        </div>
                    </form>
                </fieldset>
            </div>
                
            <div id="display" class="customization_item">
                <fieldset>
                    <legend><h2>Display</h2></legend>
                    {% set counter = 0 %}
                    {% for display_option in display %}
                        {% set description = display_description[counter] %}
                        <div style="display: table;">
                            <input type="checkbox" id="display_{{ display_option.id }}" name="display" value="{{ display_option.id }}" data-testid="display-{{ display_option.id|replace({'_': '-'}) }}"
                                   {% if display_option.isUsed == true %}checked{% endif %}
                            >
                            <label style="display: table-cell; width: 200px;" for="display_{{ display_option.id }}">{{ display_option.id }}</label>
                            <span style=" display: table-cell;"><em>{{ description | raw }}</em></span>
                        </div>
                        {% set counter = counter + 1 %}
                    {% endfor %}
                </fieldset>
            </div>
            <div id="cust_messages" data-testid="cust-messages" class="customization_item">
                <h2>Messages</h2>
                <label for="cust_messages_textarea" class="rg_info_message">You may enter a message that will appear above the student's rainbow grades.</label>
                <textarea id="cust_messages_textarea" data-testid="cust-messages-textarea">{% if 0 in messages|keys %}{{ messages[0] }}{% endif %}</textarea>
            </div>
            <div id="gradeables" data-testid="gradeables" class="customization_item">
                <h2>Gradeables</h2>
                <div style="width:45%;float:left;" id="buckets_used">
                    <h3>Assigned Buckets</h3>
                    <ol id="buckets_used_list" data-testid="buckets-used-list" style="min-height:50px;background-color:var(--standard-beige);">
                        {% for bucket in used_buckets %}
                            <li>
                                <div class="bucket-percent" style="display: inline;">
                                    <input aria-label="{{ bucket|capitalize }} percent" type="text" class="gradeable-custom-item-input" value="{{ bucket_percentages[bucket] }}" onblur="ClampPercent(this);" id="percent-{{ bucket }}"><span style="margin-right: 10px;">%</span>
                                </div>
                                {{ bucket|capitalize }} ({{ customization_data[bucket]|length }} items)
                            </li>
                        {% endfor %}
                    </ol>
                    Total: <span id="used_percentage">{% if 'used_percentage' in bucket_percentages|keys %}{{ bucket_percentages['used_percentage'] }}{% else %}0{% endif %}%</span>
                </div>
                <div style="width:45%;display:inline-block;margin-left:50px;" id="buckets_available">
                    <h3>Available Buckets</h3>
                    <ol id="buckets_available_list" data-testid="buckets-available-list" style="min-height:50px;background-color:var(--standard-light-green);">
                        {% for bucket in available_buckets %}
                            <li>
                                <div class="bucket-percent" style="display: none;">
                                    <input aria-label="{{ bucket|capitalize }} percent" type="text" class="gradeable-custom-item-input" value="0" onblur="ClampPercent(this);" id="percent-{{ bucket }}"><span style="margin-right: 10px;">%</span>
                                </div>
                                {{ bucket|capitalize }} ({{ customization_data[bucket]|length }} items)
                            </li>
                        {% endfor %}
                    </ol>
                </div>
                <div id="gradeable_config" data-testid="gradeable-config" style="background-color:var(--standard-peachpuff);margin-top:50px;overflow:auto;width:1000px;padding:5px;">
                    <h2>Category/Gradeable Configuration:
                        <i id="pencilIcon" class="fas fa-pencil-alt black-btn"></i>
                    </h2>
                    <div id="checkboxControls" style="display: none;">
                        <input id="extra_credit_checkbox" type="checkbox" name="extra_credit">
                        <label for="extra_credit_checkbox">Extra credit</label><br>

                        <input id="drop_lowest_checkbox" type="checkbox" name="drop_lowest">
                        <label for="drop_lowest_checkbox">Remove lowest</label><br>

                        <input id="enable-per-gradeable-percents" type="checkbox" name="enable-per-gradeable-percents">
                        <label for="enable-per-gradeable-percents">Enable/Edit Per Gradeable Percents:</label>
                        <i>For each bucket, you may grade by percent instead of by points.</i><br>
                    </div>
                    <div id="config-wrapper">
                        {% for bucket, gradeables in customization_data %}
                            <div id="config-{{ bucket }}" style="margin-top:25px;min-height:100px;display:none;" class="bucket_detail_div">
                                <div class="input-field">
                                    <h3 style="display:inline">{{ bucket|capitalize }}</h3>:
                                    <input
                                        type="text"
                                        class="gradeable-custom-item-input"
                                        aria-label="{{ bucket|capitalize }} config count"
                                        value="{{ bucket_counts[bucket] }}"
                                        id="config-count-{{ bucket }}"
                                        onblur="ClampGradeablesInBucket(this, {{ gradeables|length }});"
                                    >
                                    items
                                    <span style="margin-left: 100px;"></span>

                                    {% set per_gradeable_percents_checked = false %}
                                    {% for gradeable in gradeables %}
                                        {% if gradeable["override_percent"] %}
                                            {% set per_gradeable_percents_checked = true %}
                                        {% endif %}
                                    {% endfor %}
                                    <i id="per-gradeable-percents-warning-{{ bucket }}" class="fas fa-exclamation-triangle rainbow-grades-warning-triangle fa-rb tooltip">
                                        <span class="tooltiptext tooltipbottom">{# Message composed in JavaScript #}</span>
                                    </i>
                                    <input id="per-gradeable-percents-checkbox-{{ bucket }}" type="checkbox" name="per-gradeable-percents-{{ bucket }}" {{ per_gradeable_percents_checked ? 'checked' : '' }}>
                                    <label id="per-gradeable-percents-label-{{ bucket }}" for="per-gradeable-percents-checkbox-{{ bucket }}">Per Gradeable Percents</label>
                                    <span style="margin-left: 10px;"></span>
                                    <button class="btn" id="per-gradeable-percents-reset-{{ bucket }}" type="button" onclick="ResetPerGradeablePercents('{{ bucket }}');">Even Split</button>
                                    <span style="margin-left: 100px;"></span>

                                    <div id="dropLowestDiv-{{ bucket }}" style="display: none;">
                                        <label>
                                            Remove lowest:
                                            <input
                                                type="text"
                                                class="gradeable-custom-item-input"
                                                aria-label="{{ bucket|capitalize }} drop-howmany"
                                                value="{{ bucket_remove_lowest[bucket] }}"
                                                id="config-remove_lowest-{{ bucket }}"
                                            >
                                        </label>
                                        items
                                    </div>
                                </div>
                                <div style="margin-top:10px">
                                    <ol style="list-style-type: none;" id="gradeables-list-{{ bucket }}">
                                        {% for gradeable in gradeables %}
                                            <li class="gradeable-li pt-1" style="border-top: 1px solid #FFFFFF;">
                                                <div id="gradeable-pts-div-{{ gradeable["id"] }}">
                                                    <input type="text"
                                                           class="gradeable-custom-item-input"
                                                           aria-label="{{gradeable["title"]}} max score"
                                                           value="{{ gradeable["max_score"] }}"
                                                           id="maxscore-{{ gradeable["id"] }}"
                                                           title="Manual Points: {{ gradeable['manual_grading_points'] }}, Auto-graded Points: {{ gradeable['autograded_grading_points'] }}"
                                                           data-grade-release-date="{{ gradeable["grade_release_date"] }}"
                                                           readonly>
                                                    <span>pts</span>
                                                </div>
                                                <div id="gradeable-percents-div-{{ bucket }}-{{ gradeable["id"] }}">
                                                    <input type="text"
                                                           {% set default_percent = ((1 / gradeables|length) * 100)|round(1, 'floor') %}
                                                           class="gradeable-custom-item-input"
                                                           aria-label="{{gradeable["title"]}} percent"
                                                           placeholder="{{ default_percent }}"
                                                           value="{{ gradeable["override_percent"] ? gradeable["percent"] : default_percent }}"
                                                           id="percents-{{ gradeable["id"] }}"
                                                           onblur="ClampPercents(this); ClampPerGradeablePercents(this, '{{ bucket }}')">
                                                    <span>%</span>
                                                </div>
                                                <div class="gradeable-li-right-of-input">
                                                    <div class="gradeable-li-info">
                                                        <i class="fas fa-chart-line fa-gradeable-curve fa-rb" id="gradeable-curve-button-{{ gradeable['id'] }}"></i>
                                                        {{ gradeable["title"] }}
                                                        <span style="font-style: italic;font-size: 0.8em;" class="gradeable-id">{{ gradeable["id"] }}</span>
                                                    </div>
                                                    <div class="gradeable-li-curve" id="gradeable-curve-div-{{ gradeable['id'] }}">
                                                        {# Generate input boxes for each per-gradeable curve input #}
                                                        {% set curve_points = ['A-', 'B-', 'C-', 'D'] %}

                                                        {% if per_gradeable_curves[bucket][gradeable['id']] is defined %}
                                                            {% set curve_point_value = per_gradeable_curves[bucket][gradeable['id']] %}
                                                        {% else %}
                                                            {% set curve_point_value = ['', '', '', ''] %}
                                                        {% endif %}

                                                        {% for i in range(0, 3) %}
                                                            {% set html_id = 'per-gradeable-curve-' ~ gradeable['id'] ~ '-' ~ benchmarks_with_input_fields[i] %}

                                                            <label for="{{ html_id }}" class="{{ benchmarks_with_input_fields[i] }}">{{ curve_points[i] }} :</label>
                                                            <input type="text" id="{{ html_id }}" class="per-gradeable-curve-input {{ benchmarks_with_input_fields[i] }}" data-benchmark="{{ benchmarks_with_input_fields[i] }}" value="{{ curve_point_value[i] }}">
                                                        {% endfor %}
                                                        <i class="far fa-question-circle fa-rb" title="You may apply a curve on a per gradeable basis.

These values should be entered in points, not percentages.

For example, if the maximum points a student could earn
on this gradeable was 20, and you wanted to adjust
the minimum percent needed to earn an A- on this gradeable
to 50%, you would enter 10 in the A- box.

To remove a curve simply blank all boxes."></i>
                                                    </div>
                                                </div>
                                            </li>
                                        {% endfor %}
                                    </ol>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div id="display_benchmarks" class="customization_item">
                <fieldset>
                    <legend><h2>Display Benchmarks</h2></legend>
                    {% for benchmark in display_benchmarks %}
                        <p>
                            <input type="checkbox" id="display_benchmarks_{{ benchmark.id }}" name="display_benchmarks" value="{{ benchmark.id }}" data-testid="display-benchmarks-{{ benchmark.id }}"
                                   {% if benchmark.isUsed == true %}checked{% endif %}
                            >
                            <label for="display_benchmarks_{{ benchmark.id }}">{{ benchmark.id }}</label>
                        </p>
                    {% endfor %}
                </fieldset>
            </div>
            <div id="benchmark_percents" data-testid="benchmark-percents" class="customization_item">
                <h2>Benchmark Percents</h2>
                <p class="rg_info_message">You may adjust the minimum percent required to receive certain letter grades.  Enter this percentage as a decimal number.<br />As an example 90% would be entered as .9</p>
                <div class="input-boxes">
                    {% for benchmark in benchmarks_with_input_fields %}
                        {% if benchmark_percents[benchmark] is defined %}
                            {% set percent = benchmark_percents[benchmark] %}
                        {% else %}
                            {% set percent = '' %}
                        {% endif %}

                        <label for="benchmark_{{ benchmark }}" class="{{ benchmark }} input-label">{{ benchmark }}</label>
                        <input type="text" id="benchmark_{{ benchmark }}" data-testid="benchmark-{{ benchmark }}" class="benchmark_percent_input {{ benchmark }}" data-benchmark="{{ benchmark }}" value="{{ percent }}">
                    {% endfor %}
                </div>
            </div>
            <div id="section_labels" data-testid="section-labels" class="customization_item">
                <div class="section-header">
                    <h2>Section Labels</h2>
                    <i id="section-duplicate-warning" class="fas fa-exclamation-triangle same-section-name-warning-triangle fa-rb tooltip">
                        <span class="tooltiptext tooltipbottom">
                            WARNING: Multiple sections have the same name. This may result in unexpected behavior.
                        </span>
                    </i>
                </div>
                <p class="rg_info_message">You may use this area to assign a label to each section number, for example the name of the TA or TAs
                    handling the section.  You may also leave it as the default, but it may not be blank.</p>
                <div class="input-boxes">
                    {% for section, label in sections_and_labels %}
                        <label for="section_and_labels_{{ section }}" class="input-label">{{ section }}</label>
                        <input type="text" data-section="{{ section }}" class="sections_and_labels" id="section_and_labels_{{ section }}" data-testid="section-and-labels-{{ section }}" name="section_and_labels_{{ section }}" value="{{ label }}">
                    {% endfor %}
                </div>
            </div>
            <div id="final_grade_cutoffs" data-testid="final-grade-cutoffs" class="customization_item">
                <h2>Final Grade Cutoffs</h2>
                <p class="rg_info_message">You may adjust the minimum percent required to receive certain final letter grades.  Enter this percentage as a decimal number out of 100.<br />As an example 90% would be entered as 90.0</p>
                <div class="input-boxes">
                    {% for cutoff_input in final_cutoff_input_fields %}
                        {% if final_cutoff[cutoff_input] is defined %}
                            {% set percent = final_cutoff[cutoff_input] %}
                        {% else %}
                            {% set percent = '' %}
                        {% endif %}

                        <label for="cutoff_{{ cutoff_input }}" class="{{ cutoff_input }} input-label">{{ cutoff_input }}</label>
                        <input type="text" id="cutoff_{{ cutoff_input }}" data-testid="cutoff-{{ cutoff_input }}" class="final_cutoff_input {{ cutoff_input }}" name="final_grade_cutoffs" data-benchmark="{{ cutoff_input }}" value="{{ percent }}">
                    {% endfor %}
                </div>
            </div>
            <div id="manual-grading" data-testid="manual-grading" class="customization_item">
                <h2>Manual Grading</h2>
                <p class="rg_info_message">You may manually assign final grades to specific students. The note is only visible to the instructor, and it will only appear if instructor_notes is enabled under Display.</p>
                <input type="hidden" name="csrf_token" value="{{ csrfToken }}" />
                <input type="hidden" name="option" value="-1" />
                <div class="option">
                    <label for="manual-grading-user-id">
                        <span>USER ID:</span>
                        <input class="option-input" type="text" name="manual-grading-user-id" id="manual-grading-user-id" data-testid="manual-grading-user-id">
                    </label>
                    <label for="manual-grading-grade">
                        <span>Final Grade:</span>
                        <select name="manual-grading-grade" id="manual-grading-grade" data-testid="manual-grading-grade">
                            <option disabled selected value> -- select an option -- </option>
                            {% for grade in allowed_grades %}
                                <option value="{{ grade }}">{{ grade }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <label for="manual-grading-note">
                        <span>Note:</span>
                        <input class="option-input" type="text" name="manual-grading-note" id="manual-grading-note" data-testid="manual-grading-note">
                    </label>
                    <button type="submit" class="btn btn-primary" onclick="addToTable('manualGrade')" aria-label="submit" data-testid="manual-grading-submit">
                        <i class="fas fa-plus"></i>
                    </button>
                    {# This is a data table #}
                    <table id="manual-grading-table" class="table table-striped table-bordered persist-area mobile-table">
                        <thead>
                            <tr>
                                <th>USER ID</th>
                                <th>Final Grade</th>
                                <th>Note</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody id="manual-grading-table-body" data-testid="manual-grading-table-body">
                            {% for entry in manual_grade %}
                                <tr>
                                    <td>{{ entry.user }}</td>
                                    <td>{{ entry.grade }}</td>
                                    <td>{{ entry.note }}</td>
                                    <td><a onclick="deleteRow(this)"><i class="fas fa-trash"></i></a></td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="performance-warnings" class="customization_item">
                <h2>Academic Performance Warnings</h2>
                <p class="rg_info_message">Automatically generate Academic Performance Warnings for each student that fails to obtain a target score on a given list of gradeables.</p>
                <input type="hidden" name="csrf_token" value="{{ csrfToken }}" />
                <input type="hidden" name="option" value="-1" />
                <div class="option">
                    <label for="performance-warnings-message">
                        <span>Message:</span>
                        <input class="option-input" type="text" name="performance-warnings-message" id="performance-warnings-message">
                    </label>
                    <label for="performance-warnings-gradeables">
                        <span>Gradeables:</span>
                        <select name="performance-warnings-gradeables[]" id="performance-warnings-gradeables">
                            <option> -- select an option -- </option>{# Browser automatically selects first option. This option will be removed after page loads #}
                            {% for index, value in gradeables %}
                                <option value="{{ value['g_id'] }}">{{ value['g_title'] }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <label for="performance-warnings-score">
                        <span>Target Score:</span>
                        <input class="option-input" type="number" name="performance-warnings-score" id="performance-warnings-score">
                    </label>
                    <button type="submit" class="btn btn-primary" onclick="addToTable('performanceWarnings'); manageWarningsGradeables('submit');" aria-label="submit">
                        <i class="fas fa-plus"></i>
                    </button>
                    {# This is a data table #}
                    <table id="performance-warnings-table" class="table table-striped table-bordered persist-area mobile-table">
                        <thead>
                        <tr>
                            <th>Message</th>
                            <th>Gradeables</th>
                            <th>Target Score</th>
                            <th>Delete</th>
                        </tr>
                        </thead>
                        <tbody id="performance-warnings-table-body">
                        {% for entry in warning %}
                            <tr>
                                <td>{{ entry.msg }}</td>
                                <td>{{ entry.ids|join(', ') }}</td>
                                <td>{{ entry.value }}</td>
                                <td><a onclick="deleteRow(this); manageWarningsGradeables('delete');"><i class="fas fa-trash"></i></a></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="plagiarism" data-testid="plagiarism" class="customization_item">
                <h2>Penalties for Academic Dishonesty and Plagiarism</h2>
                <p class="rg_info_message">All students will receive a zero for the specified gradeable.  Additionally if a non-zero penalty value is indicated they will receive an additional reduction on the semester grade.  Penalty = 1 is a full letter grade.  Penalty = 0.5 is a half letter grade.  Penalty = 0.33 is a one third letter grade.</p>
                <input type="hidden" name="csrf_token" value="{{ csrfToken }}" />
                <input type="hidden" name="option" value="-1" />
                <div class="option">
                    <label for="plagiarism-user-id">
                        <span>USER ID:</span>
                        <input class="option-input" type="text" name="plagiarism-user-id" id="plagiarism-user-id" data-testid="plagiarism-user-id">
                    </label>
                    <label for="g_id" class="option">Gradeable:</label>
                    <select name="g_id" id="g_id" data-testid="plagiarism-gradeable-id">
                        <option disabled selected value> -- select an option -- </option>
                        {% for index, value in gradeables %}
                            <option value="{{value['g_id']}}" >{{ value['g_title'] }}</option>
                        {% endfor %}
                    </select>
                    <label for="marks">
                        <span>Penalty:</span>
                        <input class="option-input" type="text" name="marks" id="marks" data-testid="plagiarism-marks">
                    </label>
                    <button type="submit" class="btn btn-primary" onclick="addToTable('plagiarism')" aria-label="submit" data-testid="plagiarism-submit">
                        <i class="fas fa-plus"></i>
                    </button>
                    {# This is a data table #}
                    <table id="plagiarism-table" class="table table-striped table-bordered persist-area mobile-table">
                        <caption id="title"></caption>
                        <thead>
                        <tr style="text-align:left">
                            <th>USER ID</th>
                            <th>Gradeable</th>
                            <th>Penalty</th>
                            <th>Delete</th>
                        </tr>
                        </thead>
                        <tbody id="plagiarism-table-body" data-testid="plagiarism-table-body" style="text-align:left">
                        {% for entry in plagiarism %}
                            <tr>
                                <td>{{ entry.user }}</td>
                                <td>{{ entry.gradeable }}</td>
                                <td>{{ entry.penalty }}</td>
                                <td><a onclick="deleteRow(this)"><i class="fas fa-trash"></i></a></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>



    <script>
        window.manualCustomizationExists = {{ manual_customization_exists ? 'true' : 'false' }};

        $('.gradeable-li-info .tooltip').on('mouseenter', function(){
            const gradeable = $(this).closest('.gradeable-li');
            const override = gradeable.find('.override');
            const gradeable_id = override.attr('id');
            $(`#override-${gradeable_id}`).html(override.val());
        });

        ["#plagiarism-user-id", "#manual-grading-user-id"].forEach(function(user_id) {
            $(user_id).autocomplete({
                source: {{ student_full|raw }}
            });
        });
        var studentFullData = {{ student_full|raw }};
        var old_index;
        var new_index;
        var old_parent;
        var new_parent;
        var bucket_lists = $("#buckets_available_list,#buckets_used_list");
        var available_list = $("#buckets_available_list");
        var used_list = $("#buckets_used_list");
        bucket_lists.sortable({
            connectWith: "#buckets_available_list,#buckets_used_list",
            start: function(e,u){
                old_index = u.item.index();
                old_parent = u.item.parent().attr("id");
            },
            update: function(e,u){
                /* TODO: The UI either needs to be visually clear or we need to do some sort of height adjustment
                 * to make sure that one list isn't way longer than the other, otherwise it won't be intuitive where
                 * the user can and can't drop a bucket successfully.
                 */

                new_index = u.item.index();
                new_parent = u.item.parent().attr("id");
                //console.log("Moved " + u.item.text() + " from " + old_parent + "," + old_index.toString() + " to " + new_parent + "," + new_index.toString());

                //Change position of an existing used item
                if (old_parent === new_parent && new_parent === "buckets_used_list"){
                    //console.log("Rearranging!");
                    UpdateVisibilityBuckets();
                }
                else if(old_parent !==  new_parent && this.id === new_parent){
                    //XXX: In case of an update that moves across lists, we make it the new parent's job
                    var percent_input = $(u.item).find(".bucket-percent");

                    //Added a new bucket from available->used
                    if(new_parent === "buckets_used_list"){
                        //console.log("Adding!");
                        percent_input.css("display","inline");
                    }
                    else{ //Removed a bucket from used
                        //console.log("Removing!");
                        percent_input.css("display","none");
                    }
                    UpdateVisibilityBuckets();
                    UpdateUsedPercentage();
                }

            }
        });
        bucket_lists.disableSelection();

        var gradeables_lists = $("ol[id^='gradeables-list']").sortable();
        gradeables_lists.disableSelection();

        $(document).ready(function(){
            UpdateVisibilityBuckets();
        });
    </script>
</div>
