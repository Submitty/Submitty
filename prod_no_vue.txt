(function(e,g){typeof exports=="object"&&typeof module<"u"?g(require("vue")):typeof define=="function"&&define.amd?define(["vue"],g):(e=typeof globalThis<"u"?globalThis:e||self,g(e.Vue))})(this,function(e){"use strict";const g=(o,n,r)=>{const a=o[n];return a?typeof a=="function"?a():Promise.resolve(a):new Promise((t,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+n+(n.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})},x=e.defineComponent({__name:"Unknown",props:{component:{}},setup(o){return(n,r)=>(e.openBlock(),e.createElementBlock("h1",null,'Unknown component "'+e.toDisplayString(n.component)+'"',1))}}),y=(o,n)=>{const r=o.__vccOpts||o;for(const[a,t]of n)r[a]=t;return r},B=y(x,[["__scopeId","data-v-ddc22b76"]]),P=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"})),R={async render(o,n,r={}){(await(async()=>{try{return e.createApp((await g(Object.assign({"./components/Unknown.vue":()=>Promise.resolve().then(()=>P),"./components/displayQueryResults.vue":()=>Promise.resolve().then(()=>M),"./components/downloadQuery.vue":()=>Promise.resolve().then(()=>F),"./components/performanceWarning.vue":()=>Promise.resolve().then(()=>W),"./components/popup.vue":()=>Promise.resolve().then(()=>X),"./components/queryResultsTable.vue":()=>Promise.resolve().then(()=>ne),"./components/runQuery.vue":()=>Promise.resolve().then(()=>ce),"./components/sqlSchema.vue":()=>Promise.resolve().then(()=>fe),"./components/sqlToolboxPage.vue":()=>Promise.resolve().then(()=>be),"./components/toggleColumns.vue":()=>Promise.resolve().then(()=>qe)}),`./components/${n}.vue`,3)).default,r)}catch(t){return console.error(`Could not find vue component ${n}:`,t),e.createApp(B,{component:n})}})()).mount(o)}};window.submitty=R;const U={key:0,id:"query-results-error",class:"red-message"},I={id:"query-results-error-message"},L={key:1,class:"table table-striped mobile-table"},Q={key:2},_=e.defineComponent({__name:"displayQueryResults",props:{resultsData:{},queryError:{}},setup(o){return(n,r)=>(e.openBlock(),e.createElementBlock("div",null,[r[1]||(r[1]=e.createElementVNode("h2",null,"Query Results",-1)),n.queryError.error?(e.openBlock(),e.createElementBlock("div",U,[e.createElementVNode("pre",I,e.toDisplayString(n.queryError.message),1)])):e.createCommentVNode("",!0),n.resultsData.length>0&&!n.queryError.error?(e.openBlock(),e.createElementBlock("table",L,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[0]||(r[0]=e.createElementVNode("td",null,"#",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.resultsData[0],(a,t)=>(e.openBlock(),e.createElementBlock("td",{key:t},e.toDisplayString(t),1))),128))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.resultsData,(a,t)=>(e.openBlock(),e.createElementBlock("tr",{key:t},[e.createElementVNode("td",null,e.toDisplayString(t+1),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a,(s,l)=>(e.openBlock(),e.createElementBlock("td",{key:l},e.toDisplayString(s!==null?s:""),1))),128))]))),128))])])):e.createCommentVNode("",!0),!n.queryError.error&&n.resultsData.length===0?(e.openBlock(),e.createElementBlock("p",Q," No results found. ")):e.createCommentVNode("",!0)]))}}),M=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"})),q=e.defineComponent({__name:"downloadQuery",props:{data:{}},setup(o){function n(){if(!o.data.length)return;let r="";const a=Object.keys(o.data[0]);r+=`${a.map(c=>`"${c.split('"').join('""')}"`).join(",")}
`;for(const c of o.data)r+=`${a.map(i=>`"${String(c[i]??"").split('"').join('""')}"`).join(",")}
`;const t=new Blob([r],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.setAttribute("download","submitty.csv"),l.click(),URL.revokeObjectURL(s)}return(r,a)=>r.data.length?(e.openBlock(),e.createElementBlock("button",{key:0,id:"download-sql-btn",class:"btn btn-primary",onClick:n}," Download CSV ")):e.createCommentVNode("",!0)}}),F=Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"})),A={key:0,id:"performance-warning-system-message",class:"system-message warning performance-warning"},z={id:"performance-warning-system-message-text"},W=Object.freeze(Object.defineProperty({__proto__:null,default:y(e.defineComponent({__name:"performanceWarning",props:{performanceWarning:{type:Boolean},submittyQueries:{},courseQueries:{}},setup(o){const n=o,r=e.ref(n.performanceWarning);return(a,t)=>r.value?(e.openBlock(),e.createElementBlock("div",A,[e.createElementVNode("span",z," Developer Warning: Excessive or duplicate database queries observed: "+e.toDisplayString(a.submittyQueries.length+a.courseQueries.length)+' queries executed. Click "Show Page Details" at the bottom of the page for more info. ',1),e.createElementVNode("i",{id:"close-performance-warning-system-message",class:"fa fa-times performance-warning-close",onClick:t[0]||(t[0]=s=>r.value=!1)})])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-4a1827aa"]])},Symbol.toStringTag,{value:"Module"})),H={key:0,class:"popup-form"},J=["id"],Y={class:"form-title"},G={class:"form-buttons"},K={class:"form-button-container"},S=e.defineComponent({__name:"popup",props:{id:{default:"popup"},title:{},visible:{type:Boolean},savable:{type:Boolean},dismissText:{default:o=>o.savable?"Discard":"Close"},saveText:{default:"Save"}},emits:["toggle","save"],setup(o,{emit:n}){const r=o,a=n;return e.watch(()=>r.visible,(t,s)=>{s!==t&&(t?$(document).on("keydown.popup",l=>{l.key==="Escape"&&r.visible&&a("toggle",l.originalEvent)}):$(document).off("keydown.popup"))},{immediate:!0}),(t,s)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.renderSlot(t.$slots,"trigger",{},()=>[e.createElementVNode("a",{class:"btn btn-primary",onClick:s[0]||(s[0]=l=>t.$emit("toggle",l))},"Toggle popup (you should probably override this)")]),t.visible?(e.openBlock(),e.createElementBlock("div",H,[e.createElementVNode("div",{class:"popup-box",onClick:s[5]||(s[5]=l=>t.$emit("toggle",l))},[e.createElementVNode("div",{id:t.id,class:"popup-window","data-testid":"popup-window",onClick:s[4]||(s[4]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",Y,[e.createElementVNode("h1",null,e.toDisplayString(t.title),1),e.createElementVNode("button",{class:"btn btn-default close-button","data-testid":"close-button",tabindex:"0",onClick:s[1]||(s[1]=l=>t.$emit("toggle",l))}," Close ")]),e.renderSlot(t.$slots,"default",{},()=>[s[6]||(s[6]=e.createTextVNode("Default popup content (you should probably override this)"))]),e.createElementVNode("div",G,[e.createElementVNode("div",K,[e.createElementVNode("button",{class:"btn btn-default close-button","data-testid":"popup-close-button",tabindex:"0",onClick:s[2]||(s[2]=l=>t.$emit("toggle",l))},e.toDisplayString(t.dismissText),1),s[7]||(s[7]=e.createTextVNode()),t.savable?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-primary","data-testid":"popup-save-button",tabindex:"1",onClick:s[3]||(s[3]=l=>t.$emit("save",l))},e.toDisplayString(t.saveText),1)):e.createCommentVNode("",!0)])])],8,J)])])):e.createCommentVNode("",!0)],64))}}),X=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"})),Z={key:0,id:"query-results-error",class:"red-message"},v={id:"query-results-error-message"},ee={key:1,class:"table table-striped mobile-table"},te={key:2},ne=Object.freeze(Object.defineProperty({__proto__:null,default:e.defineComponent({__name:"queryResultsTable",props:{resultsData:{},queryError:{}},setup(o){return(n,r)=>(e.openBlock(),e.createElementBlock("div",null,[r[1]||(r[1]=e.createElementVNode("h2",null,"Query Results",-1)),n.queryError.error?(e.openBlock(),e.createElementBlock("div",Z,[e.createElementVNode("pre",v,"        "+e.toDisplayString(n.queryError.message)+`
      `,1)])):e.createCommentVNode("",!0),n.resultsData.length>0&&!n.queryError.error?(e.openBlock(),e.createElementBlock("table",ee,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[0]||(r[0]=e.createElementVNode("td",null,"#",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.resultsData[0],(a,t)=>(e.openBlock(),e.createElementBlock("td",{key:t},e.toDisplayString(t),1))),128))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.resultsData,(a,t)=>(e.openBlock(),e.createElementBlock("tr",{key:t},[e.createElementVNode("td",null,e.toDisplayString(t+1),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a,(s,l)=>(e.openBlock(),e.createElementBlock("td",{key:l},e.toDisplayString(s!==null?s:""),1))),128))]))),128))])])):e.createCommentVNode("",!0),!n.queryError.error&&n.resultsData.length===0?(e.openBlock(),e.createElementBlock("p",te," No results found. ")):e.createCommentVNode("",!0)]))}})},Symbol.toStringTag,{value:"Module"}));function oe(o=[]){return`${document.body.dataset.courseUrl}${o.length>0?`/${o.join("/")}`:""}`}function re(){return document.body.dataset.csrfToken??""}async function V(){const o=document.getElementById("query-results"),n=document.getElementById("download-sql-btn");o.style.display="block",n.disabled=!0;const r=new FormData;r.append("csrf_token",re());const a=document.getElementById("toolbox-textarea");r.append("sql",a.value);try{const s=await(await fetch(oe(["sql_toolbox"]),{method:"POST",body:r})).json(),l=document.getElementById("query-results-error"),c=document.getElementById("query-results-error-message"),i=o;if(i.innerHTML="",s.status!=="success"){c.textContent=s.message,l.style.display="block";return}l.style.display="none";const d=s.data;if(d.length===0){const f=document.createElement("tr"),p=document.createElement("td");p.textContent="No rows returned",f.appendChild(p),i.appendChild(f);return}const m=document.createElement("thead"),u=document.createElement("tr"),E=document.createElement("td");E.textContent="#",u.appendChild(E),Object.keys(d[0]).forEach(f=>{const p=document.createElement("td");p.textContent=f,u.appendChild(p)}),m.appendChild(u),i.appendChild(m);const D=document.createElement("tbody");d.forEach((f,p)=>{const C=document.createElement("tr"),j=document.createElement("td");j.textContent=(p+1).toString(),C.appendChild(j),Object.values(f).forEach(T=>{const O=document.createElement("td");O.textContent=T!==null?String(T):"",C.appendChild(O)}),D.appendChild(C)}),i.appendChild(D),n.disabled=!1}catch(t){console.error(t),alert(t.toString())}}function le(o){const n=document.getElementById(o);let r="";const t=n.children.item(0).children.item(0);for(let l=1;l<t.children.length;l++)r+=`"${t.children.item(l).textContent.split('"').join('""')}",`;r+=`
`;const s=n.children.item(1);for(let l=0;l<s.children.length;l++){const c=s.children.item(l);for(let i=1;i<c.children.length;i++)r+=`"${c.children.item(i).textContent.split('"').join('""')}",`;r+=`
`}return r}function se(o){const n=le(o),r=`data:text/csv;charset=utf-8,${encodeURIComponent(n)}`,a="submitty.csv",t=document.createElement("a");t.setAttribute("href",r),t.setAttribute("download",a),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function ae(){document.getElementById("run-sql-btn").addEventListener("click",()=>void V()),document.getElementById("sql-database-schema").addEventListener("click",()=>{const o=document.getElementById("sql-database-schema-content");o.style.display=o.style.display==="block"?"none":"block"}),document.querySelectorAll(".sql-database-table").forEach(o=>{o.addEventListener("click",n=>{const r=n.target;if(r&&r.nextElementSibling){const a=r.nextElementSibling;a.style.display=a.style.display==="block"?"none":"block"}})}),document.getElementById("download-sql-btn").addEventListener("click",()=>se("query-results"))}document.addEventListener("DOMContentLoaded",()=>ae());const w=e.defineComponent({__name:"runQuery",props:{query:{}},emits:["changeData","changeError"],setup(o,{emit:n}){const r=n,a=async()=>{const t=await V(o.query);t.status==="fail"?(r("changeError",!0,t.message),r("changeData",[])):(r("changeData",t.data),r("changeError",!1,""))};return(t,s)=>(e.openBlock(),e.createElementBlock("button",{id:"run-sql-btn",class:"btn btn-primary",onClick:a}," Run Query "))}}),ce=Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"})),ie={class:"database-schema"},de={id:"sql-database-schema-content",hidden:""},me={class:"columns-list"},ue={class:"sql-database-columns",hidden:""},pe={class:"columns-list"},N=y(e.defineComponent({__name:"sqlSchema",props:{data:{}},setup(o){function n(r){const a=r.target.nextElementSibling;a&&(a.hidden=!a.hidden)}return(r,a)=>(e.openBlock(),e.createElementBlock("div",ie,[e.createElementVNode("button",{id:"sql-database-schema",class:"btn btn-primary",onClick:n}," Database Schema Documentation "),e.createElementVNode("div",de,[a[0]||(a[0]=e.createElementVNode("p",null,"Click on each table to see columns",-1)),e.createElementVNode("ul",me,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.data,t=>(e.openBlock(),e.createElementBlock("li",{key:t.name},[e.createElementVNode("a",{class:"sql-database-table",onClick:n},e.toDisplayString(t.name),1),e.createElementVNode("div",ue,[e.createElementVNode("ul",pe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,s=>(e.openBlock(),e.createElementBlock("li",{key:s.name},e.toDisplayString(s.name)+" - "+e.toDisplayString(s.type),1))),128))])])]))),128))])])]))}}),[["__scopeId","data-v-a3a361c6"]]),fe=Object.freeze(Object.defineProperty({__proto__:null,default:N},Symbol.toStringTag,{value:"Module"})),ge={class:"content"},ye={id:"query-results-buttons"},be=Object.freeze(Object.defineProperty({__proto__:null,default:y(e.defineComponent({__name:"sqlToolboxPage",props:{sqlStructureData:{}},setup(o){const n=e.ref({query_name:"",query:""});function r(l,c){s.value.error=l,s.value.message=c}function a(l){t.value=l}const t=e.ref([]),s=e.ref({error:!1,message:""});return(l,c)=>(e.openBlock(),e.createElementBlock("div",ge,[c[2]||(c[2]=e.createElementVNode("h1",null,"SQL Toolbox",-1)),e.createElementVNode("div",null,[c[1]||(c[1]=e.createElementVNode("div",{id:"toolbox-info"}," Use this toolbox to run a SELECT query. You cannot run any other type of query, and may only run a single query at a time. You can download a CSV of the query results. Must Run Query before you can Download. ",-1)),e.createVNode(N,{id:"sql-schema",data:l.sqlStructureData},null,8,["data"]),e.withDirectives(e.createElementVNode("textarea",{id:"toolbox-textarea","onUpdate:modelValue":c[0]||(c[0]=i=>n.value.query=i),name:"sql","aria-label":"Input SQL"},null,512),[[e.vModelText,n.value.query]]),e.createElementVNode("div",ye,[e.createVNode(w,{id:"run-sql-btn",query:n.value.query,onChangeData:a,onChangeError:r},null,8,["query"]),e.createVNode(q,{id:"download-query-btn",data:t.value},null,8,["data"])])]),e.createVNode(_,{"query-error":s.value,"results-data":t.value},null,8,["query-error","results-data"])]))}}),[["__scopeId","data-v-e83d5bad"]])},Symbol.toStringTag,{value:"Module"}));/*! js-cookie v3.0.5 | MIT */function b(o){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var a in r)o[a]=r[a]}return o}var ke={read:function(o){return o[0]==='"'&&(o=o.slice(1,-1)),o.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(o){return encodeURIComponent(o).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function h(o,n){function r(t,s,l){if(!(typeof document>"u")){l=b({},n,l),typeof l.expires=="number"&&(l.expires=new Date(Date.now()+l.expires*864e5)),l.expires&&(l.expires=l.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var c="";for(var i in l)l[i]&&(c+="; "+i,l[i]!==!0&&(c+="="+l[i].split(";")[0]));return document.cookie=t+"="+o.write(s,t)+c}}function a(t){if(!(typeof document>"u"||arguments.length&&!t)){for(var s=document.cookie?document.cookie.split("; "):[],l={},c=0;c<s.length;c++){var i=s[c].split("="),d=i.slice(1).join("=");try{var m=decodeURIComponent(i[0]);if(l[m]=o.read(d,m),t===m)break}catch{}}return t?l[t]:l}}return Object.create({set:r,get:a,remove:function(t,s){r(t,"",b({},s,{expires:-1}))},withAttributes:function(t){return h(this.converter,b({},this.attributes,t))},withConverter:function(t){return h(b({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(o)}})}var k=h(ke,{path:"/"});const Ee={key:0,class:"btn-wrapper"},he={class:"toggle-columns-menu"},Ce=["id","onUpdate:modelValue","disabled","data-testid"],Be=["for"],_e={class:"toggle-all-buttons"},qe=Object.freeze(Object.defineProperty({__proto__:null,default:e.defineComponent({__name:"toggleColumns",props:{columns:{},labels:{},cookie:{},forced:{default:()=>[]},format:{default:"bits"},buttonWrapped:{type:Boolean}},setup(o){const n=e.ref([]),r=e.ref(!1);function a(){var c;if(o.format==="json"){const i=JSON.parse(decodeURIComponent(k.get(o.cookie)??encodeURIComponent("{}")));for(const d of Object.keys(i))o.columns.includes(d)&&(n.value[o.columns.indexOf(d)]=i[d]);for(const d of o.columns)i[d]===void 0&&(n.value[o.columns.indexOf(d)]=!0);return}else if(o.format==="bits"){const i=((c=k.get(o.cookie))==null?void 0:c.split("-"))||Array(o.columns.length).fill("1");n.value=o.columns.map((d,m)=>i[m]==="1")}}function t(){if(o.format==="json"){const c={};o.columns.forEach((i,d)=>{c[i]=n.value[d]}),k.set(o.cookie,JSON.stringify(c),{expires:365,path:"/"}),window.location.reload();return}else o.format==="bits"&&k.set(o.cookie,n.value.map(c=>c?1:0).join("-"),{expires:365,path:"/"});window.location.reload()}function s(c){n.value=n.value.map((i,d)=>{var m;return((m=o.forced)==null?void 0:m.includes(o.columns[d]))||c})}function l(){r.value=!r.value,r.value||a()}return e.onMounted(a),(c,i)=>(e.openBlock(),e.createBlock(S,{title:"Toggle Columns",visible:r.value,savable:!0,onToggle:l,onSave:t},{trigger:e.withCtx(()=>[c.buttonWrapped?(e.openBlock(),e.createElementBlock("div",Ee,[e.createElementVNode("a",{id:"toggle-columns","data-testid":"toggle-columns",class:"btn btn-primary",onClick:l},"Toggle Columns")])):(e.openBlock(),e.createElementBlock("a",{key:1,id:"toggle-columns","data-testid":"toggle-columns",class:"btn btn-primary",onClick:l},"Toggle Columns"))]),default:e.withCtx(()=>[i[3]||(i[3]=e.createElementVNode("p",{class:"toggle-columns-instructions"}," Select which columns you would like to display. ",-1)),e.createElementVNode("div",he,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.columns,(d,m)=>{var u;return e.openBlock(),e.createElementBlock("div",{key:d,class:"toggle-checkbox-area"},[e.withDirectives(e.createElementVNode("input",{id:`toggle-${d}`,"onUpdate:modelValue":E=>n.value[m]=E,type:"checkbox",class:"toggle-columns-box",disabled:(u=c.forced)==null?void 0:u.includes(d),"data-testid":`toggle-${d}`},null,8,Ce),[[e.vModelCheckbox,n.value[m]]]),e.createElementVNode("label",{for:d},e.toDisplayString(c.labels[m]),9,Be)])}),128))]),e.createElementVNode("div",_e,[e.createElementVNode("a",{class:"btn btn-primary",onClick:i[0]||(i[0]=d=>s(!0))}," All On "),i[2]||(i[2]=e.createTextVNode()),e.createElementVNode("a",{class:"btn btn-primary",onClick:i[1]||(i[1]=d=>s(!1))}," All Off ")])]),_:1},8,["visible"]))}})},Symbol.toStringTag,{value:"Module"}))});